---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->


```{r, include = FALSE}
knitr::opts_chunk$set(collapse  = TRUE,
                      comment   = "#>",
                      fig.path  = "man/figures/",
                      out.width = "100%")
```

# The threat status of endemic Atlantic Forest trees (THREAT)

[![DOI](https://zenodo.org/badge/275234070.svg)](https://zenodo.org/badge/latestdoi/275234070)

### Introduction

This repository stores the data, scripts and functions of the project ‘The
threat status of endemic Atlantic Forest trees’ (THREAT), which aims at
supporting the conservation of the Atlantic Forest tree flora. This support is
provided by the development of a workflow (and the related codes and software)
for synthesizing the information necessary for obtaining species conservation
assessments based on multiple IUCN criteria (A, B, C and D).

The THREAT workflow was developed in close association with the IUCN Red List
Authority for Brazilian Plants (CNCFlora - http://cncflora.jbrj.gov.br) and has
been validated by the Global Tree Assessment staff
(www.bgci.org/our-work/networks/gta) to ensure a workflow that follows the
IUCN Red List Categories and Criteria and thus conservation assessments that can
be more easily incorporated into the IUCN Red List of Threatened Species
(www.iucnredlist.org).

The workflow includes the evaluation of possible biases and uncertainties
related to the quality of the data and the imputation of missing species
information necessary to perform the conservation assessments following the IUCN
guidelines (IUCN 2019). Moreover, the workflow includes the production of the
files required to enter the assessments in the IUCN Species Information Service
(SIS) system (SIS Connect - https://connect.iucnredlist.org).

The codes presented here were produced specifically for the Atlantic Forest tree
species. They need to be adapted before their use for other groups of organisms
or regions.

### Description of the workflow

The THREAT workflow for obtaining species conservation assessments using
multiple IUCN criteria contains five main steps, which can be grouped into
Pre-Assessment, Assessment and Post-assessment stages (Figure 1). These steps
are:

  1. **Definitions**: the basic definitions that will determine which species 
will be included in the assessments;
  2. **Species information**: the information that must be 
compiled, estimated or imputed to obtain the population metrics;
  3. **Population metrics**: the estimation of the population metrics defined by
the IUCN as indicators of the threat of a species or taxon;
  4. **IUCN criteria assessment**: The conservation assessment itself, which 
results in the assignment of one of the IUCN Red List Categories;
  5. **Summary and export**: summary of the overall results of the assessment 
and the export of the information necessary for submission to the IUCN Red List. 

<br />

![Figure 1.](figures/THREAT_workflow.png)
**Figure 1**. The THREAT workflow. 

<br />

Note that the Pre-Assessment stage involves the compilation of key information
from the study region and the group of organism included in the assessment.
Although it represents the first step of the workflow, the code in this
repository assume that this key information was already compiled, estimated, or
imputed and that it is available in the `data` folder.

Note as well that the Post-assessment stage does not include the submission of
the assessments to the IUCN Red List and their review by the IUCN Red List
units. This is beyond the scope of the workflow which is producing the
conservation assessments and the associated files to facilitate the process of submission by the Red List Authority.

<br />


##### Details on step 1 - Definitions

Step 1 will define which assessment will be global (for all populations of the
species) or regional (for some populations of the species). For instance,
THREAT project has a regional scope (i.e. Atlantic Forest), so for species that
are non-endemic and endemic to the Atlantic Forest the assessments are regional
and global, respectively. This is why it is important to know beforehand the
endemism level of all species (e.g. endemic, non-endemic, vagrant) with respect
to the target region (see Lima et al. 2020 for the example of the Atlantic
Forest tree species). In addition, depending on the group of organisms, long
time series of habitat cover will be necessary to obtain the population size
reductions based on habitat loss. This is often the case for tree species.

Identifying and contacting local IUCN Red List Authorities as early as possible
is a key step to make sure that methods are aligned with IUCN guidelines and
their own redlisting workflows and priorities. They are responsible for
submitting the assessments to the IUCN Red List and they can facilitate the
process of reviewing the assessments before submission.

<br />

##### Details on step 2 - Species information

Species occurrence records are the input data used to obtain the species'
geographic range and other spatial population metrics that are required to
assess the IUCN criterion B. On the other hand, the input data required to
assess the IUCN criterion A (i.e. population size decline) is a vector of
population sizes per year. Therefore, the workflow assumes that population sizes
were already obtained from species abundance data, which can be done using very
different approaches depending on the group of study and the nature of evidence
(i.e. observed, estimated, inferred or suspected). What the workflow provides is
a tool to estimate species-specific population size reduction at a specific
point in time, which is needed for the assessments using criteria A and C (see
section 'Details on step 3').

Species occurrence records should be submitted to a data cleaning and validation
process to make sure that only the data with a minimum quality will be used in
the assessments. The `plantR` package (Lima et al. 2022) provides different
tools to standardize the notation associated with species records and to
validate the locality, geographical coordinates, taxonomic nomenclature and
species identifications. It also includes tools for the retrieval and removal of
specimen duplicates across biological collections.

<br />

##### Details on step 3 - Population metrics

Different population metrics are necessary for applying the IUCN criteria A, B,
C and D (criterion E is currently not considered in this workflow). A new
version 2.0 of the `ConR` package (Dauby et al. 2017, Dauby & Lima 2022) was
developed to include new functions to calculate most of these metrics.

For criterion A, the `ConR` package provides a function for fitting
statistical models to the population size vector to obtain the reductions at
a specific point in time (`ConR::pop.decline.fit()`), based on linear, 
exponential, quadratic, logistic and other trends of population decline 
through time. This is important because the time interval of population decline
needed for the assessments of criterion A or C (10 years or one-, two- or
three-generation lengths - see IUCN 2019) often does not correspond exactly to
the observed population sizes for most species.

For criterion B, the `ConR` package provides functions for calculating the
Extent of Occurrence (EOO - `ConR::EOO.computing()`), Area of Occupancy (AOO -
`ConR::AOO.computing()`), Number of Subpopulations (`ConR::subpop.comp()`) and
Number of Locations (`ConR:::locations.comp`). Although omitted from the THREAT
workflow, the detection of fluctuations in population sizes is also an important
aspect of the IUCN for some groups of organisms. In addition, the package
provides a function `ConR::AOH.estimation()` to calculate the amount and the
change in available habitat within the species EOO. This is still not used as a
population metric within the IUCN Red List Categories and Criteria but it can be
used as a measure or proxy of species presenting continuing decline, one of the
conditions necessary for assessing criterion B.

<br />

##### Details on step 4 - IUCN Red List Criteria assessment

This step corresponds to the assignment of one of the IUCN Red List Categories
(i.e. EX, EW, CR, EN, VU, NT, LC, DD) by comparing the population metrics
obtained in the previous step against the IUCN quantitative thresholds and
conditions. As mentioned above, specific functions were developed to assess the
IUCN criteria A, B, C and D, which are freely available in the new version 2.0
of the `ConR` R package (Dauby et al. 2017, Dauby & Lima 2022 - see functions
`ConR::criterion_A()`, `ConR::criterion_B()`, `ConR::criterion_C()` and
`ConR::criterion_D()`). A specific function was also developed to tell apart NT
from LC categories (see function `ConR::near.threatened()`).

In the case of multiple IUCN Red List Criteria, there is also the need to
generate a consensus IUCN Red List Category among the results of each IUCN
Criteria (see function `ConR:::cat_mult_criteria()`).

This step of the workflow also includes the assignment of tags, such as the
'Possibly Extinct' tag for Critically Endangered species or tags for species
known only for their types or very old records (e.g. over 50 years old). In the
case of regional assessments, this step may also include down-listings or
up-listings which should be duly noted (see IUCN 2012).

The new version 2.0 of `ConR` also provides functions to assess the sensitivity
of species Extent of Occurrence from the inclusion of different types of records
(e.g. not taxonomically validated records) - function `ConR::EOO.sensitivity()`.
This may be handy for selecting occurrence records to be added to the
assessments based on their individual influence on the size of the species EOO.

Also, the impact of the estimation or imputation of missing species information
in the assessments should be evaluated and presented. See the section 'Missing
information, uncertainties and solutions' below for which information may
include uncertainties in the assessments.

<br />

##### Details on step 5 - Summary and export

Many different summaries and analyses can be done to present the results of the
assessments. Besides a general description of the results (e.g. proportion of
species per IUCN Red List Category), it is important to report the Red List
Index (RLI) for the area and group of organism. The index gives a general
picture of the conservation status for a given set of species and it can be used
for comparison with other regions and/or groups. In this workflow the RLI and
its confidence limits using the R package 'red' (Cardoso 2017).

The RLI can be computed for different IUCN criteria, subsets of the species
list, or cells along a grid, so that spatial patterns of threat can be
evaluated using maps. These maps can also be generated based on the proportion
of threatened species records instead of the RLI and they can help to visualize
the regions with the highest occurrence of threatened species.

Another important evaluation is the confrontation of the new assessments with
previously published ones, which can be obtained from the most up-to-date
version of the IUCN Red List (www.iucnredlist.org) or any other
national/regional Red Lists. This is useful to know how many assessments are
new and how many species have or have not changed in their IUCN Red List
Category.

Finally, it is important to organize and export all the species information,
population metrics, and assessment results into the format required for
submission to the IUCN Red List. This is a more technical step of the workflow but
it greatly helps the incorporation of the assessments into the IUCN Red List,
particularly when assessing thousands of species. Submission can only be done by
the responsible IUCN Red List Authority and it is performed within the IUCN
Species Information Service (SIS) system (SIS Connect -
https://connect.iucnredlist.org). For plant species assessments, the system
requires 14 files that must be formatted and filled according to the IUCN
classification schemes (e.g. Growth Forms, Habitat, USes, etc) and look-up
tables (https://www.iucnredlist.org/assessment/sis). Currently, the codes to
generate the SIS Connect files are very specific to the THREAT project and most
of the pre-filled texts are in Portuguese. Thus, as mentioned earlier, codes need
to be adapted for assessments conducted in different areas, groups of organism,
and/or languages.

<br />


##### Missing information, uncertainties and solutions

Species information will be missing from the literature for some or many species
in most cases. Of course, this will depend on the group of organism and the
available knowledge of the target region. Some of this information, however, is
essential to the assessment of one or more IUCN criteria. Therefore,
biologically-informed solutions based on the best information available must be
designed, so that assessments can be made using as many IUCN criteria and
species as possible. These solutions include the estimation of missing
information (or their proxies) from the data itself or the imputation of
information using the best empirical evidence currently available for the
species or closely-related taxa. 

For the assessment of the IUCN criteria A, C, and D, essential information
include the Generation Length (GL) of the species and the Proportion of Mature
Individuals (p) in their population. In THREAT, the solution adopted for missing
GL and p was the imputation of values based on generalization for groups of
species defined based on their potential maximum height as an adult and on their
ecological groups. The choice of which values were assigned to each group was
based on the empirical evidence currently available in the literature.

Still related to the IUCN criteria A and C, it is expected that harvest trends
(e.g. timber species) and changes in habitat quality will have an impact on the
change in population sizes. For long-lived organisms, this information will
probably be missing for most species. But it is advised to take them into
account for calibrating the final results of the assessments.

For the assessment of criteria B, the Average Dispersal Distance (DD) is
mandatory information for estimating the number of subpopulations and their
fragmentation level. We implemented the function `ConR::subpop.radius()` that
applies the circular buffer method (Rivers et al., 2010) for obtaining
species-specific proxies of DD. But the pertinence of this solution may vary
according to the group of organism being assessed (e.g. sessile vs. mobile
organisms).

Still related to criterion B, the quality of the geographical coordinates
and the confidence in the species identifications can both impact the estimates
of EOO and AOO. In THREAT, we only used geographically validated records for
estimating these metrics, which is the standard procedure adopted by CNCFlora, 
the local Red List Authority. Concerning the confidence in the species
identifications, we preferably conducted assessments based only on
identifications vetted by plant taxonomists. However, for species with fewer
records (< 75), we added extra records with lower taxonomic confidence levels 
based on their position with respect to the EOO of the species. We preferably added 
records inside or close to the species EOO.

The final information needed to apply criterion B is the spatial extent (i.e.
scale) of the impacts of threat events that can impact all individuals of
species populations present in the area. This information is used to define the
number of locations where the species occur. Having specific values of this
extent is difficult as for other species' information. In THREAT, we set 10 km as
this extent outside of protected areas, which was based on the administrative
level (i.e. municipality) at which most common threat events (e.g. land-use
changes, habitat degradation) are planned/executed in the Atlantic Forest.
Occurrences inside protected areas were counted as a single location assuming
that the main and common threat to the biodiversity inside them is the same,
namely the downgrading or downsizing of the protected area.

Other missing information may restrict the application of certain criteria or
sub-criteria. The accurate delimitation of subpopulations is challenging, making
it difficult to define what is the size of individual subpopulations and thus to
apply the IUCN subcriterion C2a, even when having species abundances available.
In THREAT, we decide to apply this subcriterion only in the specific cases of
all individuals being concentrated in a single population (subcriterion C2aii).
Concerning the IUCN criterion D, we did not have accurate and spatialized
information on future threats. This is something that could be further developed
in this workflow, but currently, we decided not to apply the subcriterion D2.

<br />


**Table 1**. Main data limitations, impacts and solutions adopted by the THREAT workflow. 
```{r table1, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
|Data Limitations/Uncertainties |Criteria |Metric impacted |Solution |
|:----------------|:--------|:---------------|:--------|
| Generation Length                | A and C | Pop. size decline | Group-specific imputation | 
| Proportion of Mature Individuals | C and D | Pop. size | Group-specific Imputation |
| Impact of harvest trends         | A and C | Pop. size decline | Group-specific imputation |
| Impact of habitat quality changes | A and C | Pop. size decline | Group-specific imputation |
| Average Dispersal Distance        | B1/B2 | Subpops./Fragmentation | Estimation from data |
| Geographical coordinates of records | B1/B2   | EOO and AOO | Use only valid records |
| Species identification of records | B1/B2 | EOO and AOO | Add extra records, if needed |
| Scale of threat events  | B1/B2 | Number of locations | Set a fixed value |
| Subpopulation limits    | C2a(i)| Size of subpopulations | Subcriteria applied in few cases|
| Future threats          | D2 | - | Subcriteria not applied |
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

<br />

### Organization and content of the repository

This repository is structured as follows:

- [`R/`](https://github.com/LimaRAF/THREAT/tree/master/R/):
contains the R scripts to execute the workflow and the accessory
functions necessary to run each script. Scripts are numbered in the order
that they should be executed.

- [`data/`](https://github.com/LimaRAF/THREAT/tree/master/data):
contains raw, accessory or derived data needed for running the codes. The subfolders
here include: 
    - [`data/sis_connect/`](https://github.com/LimaRAF/THREAT/tree/master/data/sis_connect)
    contains the IUCN-required CSV files in the format to be submitted to the
    IUCN SIS connect system
    - [`data/SIS_sample_6_1/`](https://github.com/LimaRAF/THREAT/tree/master/data/SIS_sample_6_1)
    contains sample examples of the IUCN SIS connect files used as a standard to
    build the IUCN-required CSV files
    - Three other sub-folders including the shapefiles necessary to run the scripts
    - A sub-folder not available in this repository names `data-raw` where all the raw and very large files necessary to run the scripts are stored (GitHub does not accept very large files). However, all the derived data obtained from processing these raw and heavy files are available in the `data` folder.


- [`figures/`](https://github.com/LimaRAF/THREAT/tree/master/figures):
contains all the figures created during the workflow.

- [`tables/`](https://github.com/LimaRAF/THREAT/tree/master/tables):
contains the tables created during the workflow.
 



### Authors and contributors

Renato A. F. de Lima & Gilles Dauby


### How to cite

Please cite this repository as: 

> **Renato A. F. de Lima, Gilles Dauby, André L. de Gasper, Eduardo P.
Fernandez, Alexander C. Vibrans, Alexandre A. de Oliveira, Paulo I. Prado,
Vinícius C. Souza, Marinez F. de Siqueira & Hans ter Steege. (2023).
Comprehensive conservation assessments reveal high extinction risks across
Atlantic Forest trees. Manuscript under review**

### Funding

The development of this repository was funded by the European Union’s Horizon
2020 research and innovation program under the Marie Skłodowska-Curie grant
agreement No 795114. Forest inventory data was funded by grants 2013/08722-5
(São Paulo Research Foundation - FAPESP), 312075/2013-8 (Brazilian National
Council for Scientific and Technological Development - CNPq), and 2017TR1922
(Santa Catarina Research Foundation - FAPESC).

### Acknowledgments

We thank the CNCFlora staff (Patricia da Rosa, Gustavo Martinelli, Eline
Martins, Rafael Loyola, Pablo H.A. de Melo, Thaís L.B. da Cunha) for the advice
on how to apply the IUCN Red List Categories and Criteria for the Atlantic
Forest tree species. We also thank Malin Rivers and Emily Beech (BGCI) for
reviewing the methodological approach stored in this repository.

### References

> P. Cardoso, red - an R package to facilitate species red list assessments
according to the IUCN criteria. Biodivers. Data J. 5, e20530 (2017).

> G. Dauby, T. Stévart, V. Droissart, A. Cosiaux, V. Deblauwe, M.
Simo-Droissart, M. S. M. Sosef, P. P. Lowry, G. E. Schatz, R. E. Gereau, T. L.
P. Couvreur, ConR: An R package to assist large-scale multispecies preliminary
conservation assessments using distribution data. Ecol. Evol. 7, 11292–11303
(2017).

>	G. Dauby, R. A. F. de Lima, ConR: Computation of Parameters Used in
Preliminary Assessment of Conservation Status (R package version 2.0.0) (2022).

> IUCN, Guidelines for application of IUCN Red List criteria at regional and
national levels Version 4.0. (IUCN Species Survival Commission, 2012).

> IUCN Standards and Petitions Committee, Guidelines for Using the IUCN Red List
Categories and Criteria. Version 14. (Prepared by the Standards and Petitions
Committee, 2019).

> R. A. F. Lima, V. C. Souza, M. F. de Siqueira, H. ter Steege, Defining
endemism levels for biodiversity conservation: Tree species in the Atlantic
Forest hotspot. Biol. Conserv. 252, 108825 (2020).

> R. A. F. de Lima, A. Sánchez‐Tapia, S. R. Mortara, H. ter Steege, M. F. de
Siqueira, plantR: An R package and workflow for managing species records from
biological collections. Methods Ecol. Evol. 14(2), 332-339 (2023).

> M. C. Rivers, S. P. Bachman, T. R. Meagher, E. Nic Lughadha, N. A. Brummitt,
Subpopulations, locations and fragmentation: applying IUCN red list criteria to
herbarium specimen data. Biodivers. Conserv. 19, 2071–2085 (2010).
